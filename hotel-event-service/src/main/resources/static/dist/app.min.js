!function(a){"use strict";a.directives=angular.module("Directives",[]),a.services=angular.module("Services",[]),a.controllers=angular.module("Controllers",[]),a.app=angular.module("TicketMachineApp",["Directives","Services","Controllers"])}(window);
!function(a){"use strict";var b=3e3,c=1e3;a.controller("MainController",["$scope","$q","TopArtistsService","EventsService","HotelDealsService",function(a,d,e,f,g){function h(){this.locked=!1,this.initialized=!1,this.participants=2,this.fromDate=this.getDateFor(0),this.toDate=this.getDateFor(90)}h.prototype={artists:[],events:[],hotels:[],selectedItems:{artist:null,event:null,hotel:null},getDateFor:function(a){var b=new Date;return b.setDate(b.getDate()+a),b},toISODate:function(a){return moment(a).format("YYYY-MM-DD")},getArtists:function(){return console.log("Loading artists..."),e.getArtists({startDate:this.toISODate(this.fromDate),endDate:this.toISODate(this.toDate)}).then(function(a){this.artists=a}.bind(this))},getEvents:function(){return console.log("Loading events..."),f.getEvents({artistId:this.selectedItems.artist.id,startDate:this.toISODate(this.fromDate),endDate:this.toISODate(this.toDate)}).then(function(a){a.forEach(function(a){a.artist=this.selectedItems.artist}.bind(this)),this.events=a}.bind(this))},getHotels:function(){return console.log("Loading hotel deals..."),g.getHotelDeals({latitude:this.selectedItems.event.venue.latitude,longitude:this.selectedItems.event.venue.longitude,checkIn:this.toISODate(this.selectedItems.event.startDate),adults:this.participants}).then(function(a){this.hotels=a}.bind(this))},initGame:function(){this.locked=!0,this.resetState(),this.getArtists().then($.proxy(this.rollArtists,this)).then($.proxy(this.getEvents,this)).then($.proxy(this.rollEvents,this)).then($.proxy(this.getHotels,this)).then($.proxy(this.rollHotels,this)).then($.proxy(function(){this.locked=!1},this))},resetState:function(){this.artists=[],this.events=[],this.hotels=[],this.selectedItems={artist:null,event:null,hotel:null},this.initialized?["artist","event","hotel"].forEach(function(a){$("."+a+"-list").slotMachine().destroy(),$('.slot-placeholder[data-type="'+a+'"]').show()}):this.initialized=!0},rollArtists:function(){return this.roll("artist")},rollEvents:function(){return this.roll("event")},rollHotels:function(){return this.roll("hotel")},roll:function(e){console.log("Rolling "+e+"...");var f=d.defer();return setTimeout(function(){var d=$("."+e+"-list"),g=$('.slot-placeholder[data-type="'+e+'"]'),h=d.slotMachine({delay:c,direction:"down"});g.hide(),this.selectedItems[e]=null,h.shuffle(!1,function(){a.$apply(function(){a.vm.selectedItems[e]=a.vm[e+"s"][h.active],console.log("Rolling stopped for "+e+"s: ",this.selectedItems[e].name),f.resolve()}.bind(this))}.bind(this)),setTimeout(function(){h.stop()},b)}.bind(this),1e3),f.promise}},a.vm=new h,window.test=a.vm}])}(window.controllers);
!function(a){"use strict";a.directive("itemDetails",function(){return{restrict:"E",scope:{type:"@type",item:"=item",participants:"=participants"},templateUrl:"directives/item-details/item-details.html",controller:["$scope",function(a){a.range=function(a){return new Array(a||0)}}]}})}(window.directives);
!function(a){"use strict";a.directive("slotContainer",function(){return{restrict:"E",scope:{type:"@type",items:"=items"},templateUrl:"directives/slot-container/slot-container.html",controller:["$scope",function(a){var b={artist:{image:null,name:"Artists",price:"TicketMaster"},event:{image:null,name:"Events",price:"TicketMaster"},hotel:{image:null,name:"Hotel deals",price:"Hotels.com"}};a.placeholder=b[a.type]}]}})}(window.directives);
!function(a){"use strict";a.directive("slotItem",function(){return{restrict:"E",scope:{item:"=item"},templateUrl:"directives/slot-item/slot-item.html"}})}(window.directives);
!function(a){"use strict";a.factory("EventsService",["$http",function(a){function b(){this.url="/events"}return b.prototype={getEvents:function(b){return a({method:"GET",url:this.url,params:b}).then(function(a){return $.map(a.data,function(a){return{name:a.city+", "+a.countryCode,image:a.cityImageUrl,date:moment(a.localStartDate).format("YYYY.MM.DD."),time:a.localStartTime,price:a.minPrice,priceFormatted:"$"+parseFloat(a.minPrice),venue:{name:a.venueName,address:a.venueAddress,longitude:a.longitude,latitude:a.latitude},url:a.url}})})}},new b}])}(window.services);
!function(a){"use strict";a.factory("HotelDealsService",["$http",function(a){function b(){this.url="http://api.theticketmachine.net/hotels"}return b.prototype={getHotelDeals:function(b){return a({method:"GET",url:this.url,params:b}).then(function(a){return $.map(a.data.result,function(a){return{name:a.name,image:a.image,priceFormatted:a.price,starRating:parseInt(a.starRating,10),guestRating:a.guestRating,tripAdvisorRating:a.tripAdvisorRating,url:a.url}})})}},new b}])}(window.services);
!function(a){"use strict";a.factory("TopArtistsService",["$http",function(a){function b(){this.url="/artists"}return b.prototype={getArtists:function(b){return a({method:"GET",url:this.url,params:b}).then(function(a){return $.map(a.data,function(a){return{id:a.id,name:a.name,image:a.picture}})})}},new b}])}(window.services);