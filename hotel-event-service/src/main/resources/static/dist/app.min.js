!function(a){"use strict";a.directives=angular.module("Directives",[]),a.services=angular.module("Services",[]),a.controllers=angular.module("Controllers",[]),a.app=angular.module("TicketMachineApp",["Directives","Services","Controllers","720kb.datepicker"])}(window);
!function(a){"use strict";var b=3e3,c=1e3;a.controller("MainController",["$scope","$q","TopArtistsService","EventsService","HotelDealsService",function(a,d,e,f,g){function h(){}h.prototype={participants:2,fromDate:null,toDate:null,artists:[],events:[],hotels:[],selectedItems:{artist:null,event:null,hotel:null},getDateFor:function(a){var b=new Date;return b.setDate(b.getDate()+a),b.toString()},getArtists:function(){return console.log("getArtists"),e.getArtists({startDate:this.fromDate,endDate:this.toDate}).then(function(a){this.artists=a}.bind(this))},getEvents:function(){return console.log("getEvents"),f.getEvents({artistId:this.selectedItems.artist.id,startDate:this.fromDate,endDate:this.toDate}).then(function(a){a.forEach(function(a){a.artist=this.selectedItems.artist}.bind(this)),this.events=a}.bind(this))},getHotels:function(){return console.log("getHotels"),g.getHotelDeals({latitude:this.selectedItems.event.latitude,longitude:this.selectedItems.event.longitude,checkIn:this.selectedItems.event.startDate,adults:this.participants}).then(function(a){this.hotels=a}.bind(this))},initGame:function(){this.getArtists().then($.proxy(this.rollArtists,this)).then($.proxy(this.getEvents,this)).then($.proxy(this.rollEvents,this)).then($.proxy(this.getHotels,this)).then($.proxy(this.rollHotels,this))},rollArtists:function(){return this.roll("artist")},rollEvents:function(){return this.roll("event")},rollHotels:function(){return this.roll("hotel")},roll:function(e){console.log("roll",e);var f=d.defer();return setTimeout(function(){var d=$("."+e+"-list"),g=$('.slot-placeholder[data-type="'+e+'"]'),h=d.slotMachine({delay:c,direction:"down"});g.hide(),this.selectedItems[e]=null,h.shuffle(!1,function(){a.$apply(function(){a.vm.selectedItems[e]=a.vm[e+"s"][h.active],console.log("Machine stopped",e,this.selectedItems[e]),f.resolve()}.bind(this))}.bind(this)),setTimeout(function(){h.stop()},b)}.bind(this),1e3),f.promise}},a.vm=new h,window.test=a.vm}])}(window.controllers);
!function(a){"use strict";a.directive("itemDetails",function(){return{restrict:"E",scope:{type:"@type",item:"=item"},templateUrl:"directives/item-details/item-details.html"}})}(window.directives);
!function(a){"use strict";a.directive("slotContainer",function(){return{restrict:"E",scope:{type:"@type",items:"=items"},templateUrl:"directives/slot-container/slot-container.html",controller:["$scope",function(a){a.placeholder={image:null,name:""}}]}})}(window.directives);
!function(a){"use strict";a.directive("slotItem",function(){return{restrict:"E",scope:{item:"=item"},templateUrl:"directives/slot-item/slot-item.html"}})}(window.directives);
!function(a){"use strict";a.factory("EventsService",["$http",function(a){function b(){this.url="/events"}return b.prototype={getEvents:function(b){return a({method:"GET",url:this.url,params:b}).then(function(a){return $.map(a.data,function(a){return{name:a.city+", "+a.countryCode,image:a.cityImageUrl,price:a.minPrice,url:a.url}})})}},new b}])}(window.services);
!function(a){"use strict";a.factory("HotelDealsService",["$http",function(a){function b(){this.url="http://api.theticketmachine.net/hotels"}return b.prototype={getHotelDeals:function(b){return a({method:"GET",url:this.url,params:b}).then(function(a){return $.map(a.data.result,function(a){return{name:a.name,image:a.image,price:a.price,url:a.url}})})}},new b}])}(window.services);
!function(a){"use strict";a.factory("TopArtistsService",["$http",function(a){function b(){this.url="/artists"}return b.prototype={getArtists:function(b){return a({method:"GET",url:this.url,params:b}).then(function(a){return $.map(a.data,function(a){return{id:a.id,name:a.name,image:a.picture}})})}},new b}])}(window.services);