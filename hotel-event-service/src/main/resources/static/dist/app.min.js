!function(a){"use strict";a.directives=angular.module("Directives",[]),a.services=angular.module("Services",[]),a.controllers=angular.module("Controllers",[]),a.app=angular.module("TicketMachineApp",["Directives","Services","Controllers"])}(window);
function toISODate(a){return moment(a).format("YYYY-MM-DD")}!function(a){"use strict";var b=100,c=4e3;a.controller("MainController",["$scope","$q","TopArtistsService","EventsService","HotelDealsService",function(a,d,e,f,g){function h(){this.locked=!1,this.initialized=!1,this.participants=2,this.fromDate=this.getDateFor(0),this.toDate=this.getDateFor(90),a.$on("initGame",$.proxy(this.initGame,this))}h.prototype={artists:[],events:[],hotels:[],selectedItems:{artist:null,event:null,hotel:null},getDateFor:function(a){var b=new Date;return b.setDate(b.getDate()+a),b},getArtists:function(){return console.log("Loading artists..."),e.getArtists({startDate:toISODate(this.fromDate),endDate:toISODate(this.toDate)}).then(function(a){this.artists=a}.bind(this))},getEvents:function(){return console.log("Loading events..."),f.getEvents({artistId:this.selectedItems.artist.id,startDate:toISODate(this.fromDate),endDate:toISODate(this.toDate)}).then(function(a){a.forEach(function(a){a.artist=this.selectedItems.artist}.bind(this)),this.events=a}.bind(this))},getHotels:function(){return console.log("Loading hotel deals..."),g.getHotelDeals({latitude:this.selectedItems.event.venue.latitude,longitude:this.selectedItems.event.venue.longitude,checkIn:toISODate(this.selectedItems.event.startDate),adults:this.participants}).then(function(a){this.hotels=a}.bind(this))},initGame:function(){this.locked=!0,this.resetState(),this.getArtists().then($.proxy(this.rollArtists,this)).then($.proxy(this.getEvents,this)).then($.proxy(this.rollEvents,this)).then($.proxy(this.getHotels,this)).then($.proxy(this.rollHotels,this)).then($.proxy(function(){this.locked=!1},this))},resetState:function(){this.artists=[],this.events=[],this.hotels=[],this.selectedItems={artist:null,event:null,hotel:null},this.initialized?["artist","event","hotel"].forEach(function(a){$("."+a+"-list").slotMachine().destroy(),$('.slot-placeholder[data-type="'+a+'"]').show()}):this.initialized=!0},rollArtists:function(){return this.roll("artist")},rollEvents:function(){return this.roll("event")},rollHotels:function(){return this.roll("hotel")},roll:function(e){console.log("Rolling "+e+"...");var f=d.defer();return setTimeout(function(){var d=$("."+e+"-list"),g=$('.slot-placeholder[data-type="'+e+'"]'),h=d.slotMachine({delay:"hotel"===e?1e3:c,direction:"down"});g.hide(),this.selectedItems[e]=null,h.shuffle(!1,function(){}.bind(this)),setTimeout($.proxy(function(){a.$apply(function(){h.stop(),a.vm.selectedItems[e]=a.vm[e+"s"][h.active],console.log("Rolling stopped for "+e+"s: ",this.selectedItems[e].name),f.resolve()}.bind(this))},this),b)}.bind(this),1e3),f.promise}},a.vm=new h,window.test=a.vm}])}(window.controllers);
!function(a){"use strict";a.directive("itemDetails",function(){return{restrict:"E",scope:{type:"@type",item:"=item",participants:"=participants"},templateUrl:"directives/item-details/item-details.html",controller:["$scope",function(a){a.range=function(a){return new Array(a||0)}}]}})}(window.directives);
!function(a){"use strict";a.directive("searchModule",function(){return{restrict:"E",scope:{participants:"=participants",fromDate:"=fromDate",toDate:"=toDate",locked:"=locked"},templateUrl:"directives/search-module/search-module.html",controller:["$scope",function(a){a.invalidStartDate=!1,a.invalidEndDate=!1,a.errorMessage=null,a.search=function(){a.$emit("initGame")},a.$watch("fromDate",function(){moment(toISODate()).isAfter(toISODate(a.fromDate))?(a.invalidStartDate=!0,a.errorMessage="Your start date can't be in the past!"):a.invalidStartDate=!1}),a.$watch("toDate",function(){moment(toISODate(a.fromDate)).add(30,"days").isAfter(toISODate(a.toDate))?(a.invalidEndDate=!0,a.errorMessage="Date range must be at least 30 days!"):a.invalidEndDate=!1}),window.test2=a}]}})}(window.directives);
!function(a){"use strict";a.directive("slotContainer",function(){return{restrict:"E",scope:{type:"@type",items:"=items"},templateUrl:"directives/slot-container/slot-container.html",controller:["$scope",function(a){var b={artist:{image:null,name:"Artists",priceFormatted:"TicketMaster"},event:{image:null,name:"Events",priceFormatted:"TicketMaster"},hotel:{image:null,name:"Hotel deals",priceFormatted:"Hotels.com"}};a.placeholder=b[a.type]}]}})}(window.directives);
!function(a){"use strict";a.directive("slotItem",function(){return{restrict:"E",scope:{item:"=item"},templateUrl:"directives/slot-item/slot-item.html"}})}(window.directives);
!function(a){"use strict";a.factory("EventsService",["$http",function(a){function b(){this.url="/events"}return b.prototype={getEvents:function(b){return a({method:"GET",url:this.url,params:b}).then(function(a){return $.map(a.data,function(a){return{name:a.city+", "+a.countryCode,image:a.cityImageUrl,date:moment(a.localStartDate).format("YYYY.MM.DD."),time:a.localStartTime,price:a.minPrice,priceFormatted:"$"+parseFloat(a.minPrice),venue:{name:a.venueName,address:a.venueAddress,longitude:a.longitude,latitude:a.latitude},url:a.url}})})}},new b}])}(window.services);
!function(a){"use strict";a.factory("HotelDealsService",["$http",function(a){function b(){this.url="/hotels"}return b.prototype={getHotelDeals:function(b){return a({method:"GET",url:this.url,params:b}).then(function(a){return a.data.result&&a.data.result.length?$.map(a.data.result,function(a){return{name:a.name,image:a.image,address:a.address,priceFormatted:a.price,starRating:parseInt(a.starRating,10),guestRating:a.guestRating,tripAdvisorRating:a.tripAdvisorRating,url:a.url}}):[{name:"Hotel Alexander Plaza",image:"http://exp.cdn-hotels.com/hotels/1000000/530000/526000/525997/400809e0_b.jpg",address:"Hotel Alexander Plaza",priceFormatted:"$83",starRating:4,guestRating:4.4,tripAdvisorRating:4,url:"https://www.hotels.com/hotel/details.html?q-check-out=2017-02-03&q-check-in=2017-02-01&WOE=5&WOD=3&q-room-0-children=0&pa=1&tab=description&hotel-id=232896&q-room-0-adults=1&YGF=3&MGT=2&ZSX=0&SYE=3&pos=HCOM_US#rooms-and-rates-anchor"},{name:"Hotel Nikolai Residence",image:"http://exp.cdn-hotels.com/hotels/7000000/6660000/6654500/6654431/6654431_13_b.jpg",address:"Hotel Nikolai Residence",priceFormatted:"$105",starRating:3,guestRating:4.7,tripAdvisorRating:4.5,url:"https://www.hotels.com/hotel/details.html?q-check-out=2017-02-03&q-check-in=2017-02-01&WOE=5&WOD=3&q-room-0-children=0&pa=6&tab=description&hotel-id=442447&q-room-0-adults=1&YGF=3&MGT=2&ZSX=0&SYE=3&pos=HCOM_US#rooms-and-rates-anchor"}]})}},new b}])}(window.services);
!function(a){"use strict";a.factory("TopArtistsService",["$http",function(a){function b(){this.url="/artists"}return b.prototype={getArtists:function(b){return a({method:"GET",url:this.url,params:b}).then(function(a){return $.map(a.data,function(a){return{id:a.id,name:a.name,image:a.picture}})})}},new b}])}(window.services);